<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>Sign In to Midspace</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    </head>
    <body>
        <!--[if IE 8]>
            <script src="//cdnjs.cloudflare.com/ajax/libs/ie8/0.2.5/ie8.js"></script>
        <![endif]-->

        <!--[if lte IE 9]>
            <script src="https://cdn.auth0.com/js/base64.js"></script>
            <script src="https://cdn.auth0.com/js/es5-shim.min.js"></script>
        <![endif]-->

        <script src="https://cdn.auth0.com/js/lock/11.30/lock.min.js"></script>
        <script>
            // Decode utf8 characters properly
            var config = JSON.parse(decodeURIComponent(escape(window.atob("@@config@@"))));
            console.log(config);
            config.extraParams = config.extraParams || {};
            var connection = config.connection;
            var prompt = config.prompt;
            var languageDictionary;
            var language;

            if (config.dict && config.dict.signin && config.dict.signin.title) {
                languageDictionary = {
                    title: "Sign In",
                    signUpTerms:
                        'By signing up, you agree to our <a href="https://midspace.app/terms-and-conditions">terms and conditions</a> and <a href="https://midspace.app/privacy-policy">privacy policy</a>.',
                };
            } else if (typeof config.dict === "string") {
                language = config.dict;
            }

            var loginHint = config.extraParams.login_hint;
            var colors = config.colors || {};

            // Available Lock configuration options: https://auth0.com/docs/libraries/lock/v11/configuration
            var lock = new Auth0Lock(config.clientID, config.auth0Domain, {
                auth: {
                    redirect: true,
                    redirectUrl: config.callbackURL,
                    responseType: "token",
                    params: config.internalOptions,
                },
                avatar: null,
                configurationBaseUrl: config.clientConfigurationBaseUrl,
                overrides: {
                    __tenant: config.auth0Tenant,
                    __token_issuer: config.authorizationServer.issuer,
                },
                assetsUrl: config.assetsUrl,
                allowedConnections: connection ? [connection] : null,
                rememberLastLogin: !prompt,
                language: language,
                languageDictionary: languageDictionary,
                theme: {
                    logo: "https://images.squarespace-cdn.com/content/v1/609d52f518379f382edb3b2e/452da127-ce9f-4e6f-bcc0-f8e8b9715c8c/Midspace-formerly-Clowdr-Purple.png?format=1000w",
                    primaryColor: colors.primary ? colors.primary : "green",
                },
                prefill: loginHint ? { email: loginHint, username: loginHint } : null,
                closable: false,
                defaultADUsernameFromEmailPrefix: false,

                allowForgotPassword: true,
                loginAfterSignUp: true,
                allowShowPassword: true,
                allowAutocomplete: true,
                allowPasswordAutocomplete: true,
                initialScreen:
                    (config.extraParams.screen_hint || "login").toLowerCase() === "signup" ? "signUp" : "login",
            });

            if (colors.page_background) {
                var css = ".auth0-lock.auth0-lock .auth0-lock-overlay { background: " + colors.page_background + " }";
                var style = document.createElement("style");

                style.appendChild(document.createTextNode(css));

                document.body.appendChild(style);
            }

            lock.show();
        </script>
    </body>
</html>
