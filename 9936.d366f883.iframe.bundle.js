"use strict";(self.webpackChunk_midspace_frontend=self.webpackChunk_midspace_frontend||[]).push([[9936],{"./src/aspects/Conference/Attend/Room/Stream/Backstages.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Backstages});__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.number.constructor.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.filter.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.some.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.map.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.promise.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.is-array.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.symbol.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.symbol.description.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.symbol.iterator.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.slice.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.function.name.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.array.from.js");var chakra_ui_layout_esm=__webpack_require__("../node_modules/.pnpm/@chakra-ui+layout@1.7.4_d5de66fc214059f645050e36d066c00a/node_modules/@chakra-ui/layout/dist/chakra-ui-layout.esm.js"),chakra_ui_alert_esm=__webpack_require__("../node_modules/.pnpm/@chakra-ui+alert@1.3.5_d5de66fc214059f645050e36d066c00a/node_modules/@chakra-ui/alert/dist/chakra-ui-alert.esm.js"),chakra_ui_button_esm=__webpack_require__("../node_modules/.pnpm/@chakra-ui+button@1.5.5_d5de66fc214059f645050e36d066c00a/node_modules/@chakra-ui/button/dist/chakra-ui-button.esm.js"),chakra_ui_modal_esm=__webpack_require__("../node_modules/.pnpm/@chakra-ui+modal@1.10.7_d24435ba52f1f88b08cc54a1f1d4e56f/node_modules/@chakra-ui/modal/dist/chakra-ui-modal.esm.js"),es=__webpack_require__("../node_modules/.pnpm/ramda@0.28.0/node_modules/ramda/es/index.js"),react=__webpack_require__("../node_modules/.pnpm/react@17.0.2/node_modules/react/index.js"),web=__webpack_require__("../node_modules/.pnpm/react-reverse-portal@2.1.0_react-dom@17.0.2+react@17.0.2/node_modules/react-reverse-portal/dist/web/index.js"),graphql=__webpack_require__("./src/generated/graphql.tsx"),useRealTime=__webpack_require__("./src/aspects/Hooks/useRealTime.tsx"),SharedRoomContextProvider=__webpack_require__("./src/aspects/Room/SharedRoomContextProvider.tsx"),chakra_ui_color_mode_esm=(__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.date.to-string.js"),__webpack_require__("../node_modules/.pnpm/core-js@3.21.0/node_modules/core-js/modules/es.date.now.js"),__webpack_require__("../node_modules/.pnpm/@chakra-ui+color-mode@1.4.3_react@17.0.2/node_modules/@chakra-ui/color-mode/dist/chakra-ui-color-mode.esm.js")),chakra_ui_system_esm=__webpack_require__("../node_modules/.pnpm/@chakra-ui+system@1.10.3_922a85da57e3646a57465b7970b0de85/node_modules/@chakra-ui/system/dist/chakra-ui-system.esm.js"),formatRelative=__webpack_require__("../node_modules/.pnpm/date-fns@2.28.0/node_modules/date-fns/esm/formatRelative/index.js"),lib=__webpack_require__("../node_modules/.pnpm/react-emoji-render@1.2.4_react-dom@17.0.2+react@17.0.2/node_modules/react-emoji-render/lib/index.js"),AppLayoutContext=__webpack_require__("./src/aspects/App/AppLayoutContext.tsx"),EmojiFloatContainer=__webpack_require__("./src/aspects/Emoji/EmojiFloatContainer.tsx"),StreamTextCaptions=__webpack_require__("./src/aspects/Conference/Attend/Room/StreamTextCaptions.tsx");function isEventNow(now,event){var scheduledStartTime=Date.parse(event.scheduledStartTime)-3e3,scheduledEndTime=Date.parse(event.scheduledEndTime);return now>=scheduledStartTime&&now<=scheduledEndTime}function isEventSoon(now,event){var scheduledStartTime=Date.parse(event.scheduledStartTime);return now>=scheduledStartTime-12e5-5e3&&now<=scheduledStartTime}var VonageBackstage=__webpack_require__("./src/aspects/Conference/Attend/Room/Stream/VonageBackstage.tsx"),jsx_runtime=__webpack_require__("../node_modules/.pnpm/react@17.0.2/node_modules/react/jsx-runtime.js");function Backstage(_ref){var event=_ref.event,selectedEventId=_ref.selectedEventId,setSelectedEventId=_ref.setSelectedEventId,roomChatId=_ref.roomChatId,onLeave=_ref.onLeave,hlsUri=_ref.hlsUri,offAirColor=(0,chakra_ui_color_mode_esm.ff)("Backstage.offAirBorderColor-light","Backstage.offAirBorderColor-dark"),offAirBorderColour=(0,chakra_ui_system_esm.dQ)("colors",offAirColor),onAirColor=(0,chakra_ui_color_mode_esm.ff)("Backstage.onAirBorderColor-light","Backstage.onAirBorderColor-dark"),onAirBorderColour=(0,chakra_ui_system_esm.dQ)("colors",onAirColor),now=(0,useRealTime.$)(5e3),isNow=isEventNow(now,event),isSoon=isEventSoon(now,event),isActive=isNow||isSoon,category=isNow?"Happening now":isSoon?"Starting soon":"Ended",borderColour=isNow?onAirBorderColour:offAirBorderColour,title=null!=event&&event.item?event.item.title+(event.name.length?" ("+event.name+")":""):event.name,isSelected=event.id===selectedEventId,summaryInfo=(0,react.useMemo)((function(){return(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.Ug,{border:"1px "+borderColour+" solid",width:"max-content",maxW:"100%",w:"100%",justifyContent:"space-between",p:4,alignItems:"center",borderRadius:"md",children:[(0,jsx_runtime.jsx)(chakra_ui_layout_esm.X6,{as:"h3",size:"md",width:"min-content",textAlign:"right",mr:8,whiteSpace:"normal",children:category}),(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.gC,{px:8,alignItems:"left",flexGrow:1,children:[(0,jsx_runtime.jsx)(chakra_ui_layout_esm.X6,{as:"h4",size:"md",textAlign:"left",mt:2,mb:1,whiteSpace:"normal",children:(0,jsx_runtime.jsx)(lib.Gl,{className:"twemoji",text:title})}),(0,jsx_runtime.jsx)(chakra_ui_layout_esm.xv,{my:2,fontStyle:"italic",whiteSpace:"normal",children:(0,formatRelative.Z)(Date.parse(event.scheduledStartTime),Date.now())})]}),(0,jsx_runtime.jsx)(chakra_ui_button_esm.zx,{colorScheme:isSelected?"DestructiveActionButton":"PrimaryActionButton",onClick:function onClick(){return setSelectedEventId(isSelected?null:event.id)},height:"min-content",py:4,whiteSpace:"normal",variant:isSelected?"outline":"solid",children:(0,jsx_runtime.jsx)(chakra_ui_layout_esm.xv,{fontSize:"lg",whiteSpace:"normal",children:isSelected?"Exit this backstage":selectedEventId?"Switch to this backstage":"Show this backstage"})})]},event.id)}),[borderColour,category,event.id,event.scheduledStartTime,isSelected,selectedEventId,setSelectedEventId,title]),vonageBackstage=(0,react.useMemo)((function(){return(0,jsx_runtime.jsx)(VonageBackstage.l,{event,onLeave,hlsUri})}),[event,onLeave,hlsUri]),mainPaneHeight=(0,AppLayoutContext.F)().mainPaneHeight,area=(0,react.useMemo)((function(){return isSelected?(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.xu,{h:"max("+mainPaneHeight+"px, 40em)",mt:2,p:2,border:isNow?"solid "+onAirBorderColour:void 0,borderWidth:4,children:[vonageBackstage,(0,jsx_runtime.jsx)(StreamTextCaptions.Z,{streamTextEventId:event.streamTextEventId}),(0,jsx_runtime.jsx)(EmojiFloatContainer.Z,{chatId:null!=roomChatId?roomChatId:"",xDurationMs:4e3,yDurationMs:1e4})]}):isActive?void 0:(0,jsx_runtime.jsxs)(chakra_ui_alert_esm.bZ,{status:"warning",mb:8,children:[(0,jsx_runtime.jsx)(chakra_ui_alert_esm.zM,{}),"This event has now finished. Once you close this backstage, you will not be able to rejoin it."]})}),[isActive,isNow,isSelected,vonageBackstage,roomChatId,event.streamTextEventId,onAirBorderColour,mainPaneHeight]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[summaryInfo,area]})}try{Backstage.displayName="Backstage",Backstage.__docgenInfo={description:"",displayName:"Backstage",props:{roomChatId:{defaultValue:null,description:"",name:"roomChatId",required:!0,type:{name:"string | null | undefined"}},event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"Room_EventSummaryFragment"}},selectedEventId:{defaultValue:null,description:"",name:"selectedEventId",required:!0,type:{name:"string | null"}},setSelectedEventId:{defaultValue:null,description:"",name:"setSelectedEventId",required:!0,type:{name:"(value: string | null) => void"}},onLeave:{defaultValue:null,description:"",name:"onLeave",required:!1,type:{name:"(() => void)"}},hlsUri:{defaultValue:null,description:"",name:"hlsUri",required:!0,type:{name:"string | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/aspects/Conference/Attend/Room/Stream/Backstage.tsx#Backstage"]={docgenInfo:Backstage.__docgenInfo,name:"Backstage",path:"src/aspects/Conference/Attend/Room/Stream/Backstage.tsx#Backstage"})}catch(__react_docgen_typescript_loader_error){}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Backstages(_ref){var showBackstage=_ref.showBackstage,roomName=_ref.roomName,roomEvents=_ref.roomEvents,currentRoomEventId=_ref.currentRoomEventId,nextRoomEventId=_ref.nextRoomEventId,setWatchStreamForEventId=_ref.setWatchStreamForEventId,selectedEventId=_ref.selectedEventId,onEventSelected=_ref.onEventSelected,roomChatId=_ref.roomChatId,onLeave=_ref.onLeave,hlsUri=_ref.hlsUri,sortedEvents=(0,react.useMemo)((function(){return es.HCG([es.zU3((function(x){var _x$scheduledStartTime;return null!==(_x$scheduledStartTime=x.scheduledStartTime)&&void 0!==_x$scheduledStartTime?_x$scheduledStartTime:Number.POSITIVE_INFINITY}))],roomEvents.filter((function(event){return graphql.kdg.Livestream===event.modeName})))}),[roomEvents]),now=(0,useRealTime.$)(5e3),_useState2=_slicedToArray((0,react.useState)(null),2),activeEvents=_useState2[0],setActiveEvents=_useState2[1];(0,react.useEffect)((function(){var newActiveEvents=sortedEvents.filter((function(x){return isEventNow(now,x)||isEventSoon(now,x)||selectedEventId===x.id}));setActiveEvents((function(oldActiveEvents){return!oldActiveEvents||oldActiveEvents.length!==newActiveEvents.length||newActiveEvents.some((function(x,idx){return idx>=oldActiveEvents.length||oldActiveEvents[idx].id!==x.id}))?newActiveEvents:oldActiveEvents}))}),[now,selectedEventId,sortedEvents]),(0,react.useEffect)((function(){onEventSelected((function(oldId){return oldId||1!==(null==activeEvents?void 0:activeEvents.length)?oldId:activeEvents[0].id}))}),[activeEvents,onEventSelected]);var backstages=(0,react.useMemo)((function(){return(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.xu,{mt:4,w:"100%",children:[null==activeEvents?void 0:activeEvents.map((function(x){return(0,jsx_runtime.jsx)(chakra_ui_layout_esm.xu,{mt:2,w:"100%",children:(0,jsx_runtime.jsx)(Backstage,{event:x,selectedEventId,setSelectedEventId:onEventSelected,roomChatId,onLeave,hlsUri})},x.id)})),0===(null==activeEvents?void 0:activeEvents.length)?(0,jsx_runtime.jsx)(chakra_ui_layout_esm.xv,{textAlign:"center",my:8,fontSize:"lg",children:"No current or upcoming events in the backstage."}):void 0]})}),[activeEvents,roomChatId,selectedEventId,onEventSelected,onLeave,hlsUri]),sharedRoomContext=(0,react.useContext)(SharedRoomContextProvider.p),_useState4=_slicedToArray((0,react.useState)(!1),2),isWatchStreamConfirmOpen=_useState4[0],setIsWatchStreamConfirmOpen=_useState4[1],cancelRef=(0,react.useRef)(null),welcomeInfo=(0,react.useMemo)((function(){return(0,jsx_runtime.jsxs)(chakra_ui_alert_esm.bZ,{status:"info",children:[(0,jsx_runtime.jsx)(chakra_ui_alert_esm.zM,{}),(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.xu,{flex:"1",children:[(0,jsx_runtime.jsxs)(chakra_ui_alert_esm.Cd,{children:["Welcome to the backstages for ",roomName]}),(0,jsx_runtime.jsx)(chakra_ui_alert_esm.X,{display:"block",children:(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.QI,{children:[(0,jsx_runtime.jsx)(chakra_ui_layout_esm.HC,{children:"Each presentation and Q&A event in this room has a backstage."}),(0,jsx_runtime.jsx)(chakra_ui_layout_esm.HC,{children:"Each backstage becomes available to join twenty minutes before the associated event starts."}),(0,jsx_runtime.jsx)(chakra_ui_layout_esm.HC,{children:"Keep an eye on the chat for questions!"})]})})]})]})}),[roomName]),videoChatForPermissionReset=(0,react.useMemo)((function(){return showBackstage&&!selectedEventId&&sharedRoomContext?(0,jsx_runtime.jsx)(chakra_ui_layout_esm.xu,{display:"none",children:(0,jsx_runtime.jsx)(web.t0,{eventId:null,node:sharedRoomContext.vonagePortalNode,vonageSessionId:"",getAccessToken:_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return","");case 1:case"end":return _context.stop()}}),_callee)}))),disable:!0,isBackstageRoom:!0})}):void 0}),[selectedEventId,sharedRoomContext,showBackstage]),exitBackstageButton=(0,react.useMemo)((function(){return selectedEventId?void 0:currentRoomEventId||nextRoomEventId?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(chakra_ui_button_esm.zx,{variant:"outline",borderColor:"DestructiveActionButton.600",color:"DestructiveActionButton.600",onClick:function onClick(){return setIsWatchStreamConfirmOpen(!0)},mt:4,children:"Watch live-stream"}),(0,jsx_runtime.jsx)(chakra_ui_modal_esm.aR,{isOpen:isWatchStreamConfirmOpen,leastDestructiveRef:cancelRef,onClose:function onClose(){return setIsWatchStreamConfirmOpen(!1)},children:(0,jsx_runtime.jsx)(chakra_ui_modal_esm.dh,{children:(0,jsx_runtime.jsxs)(chakra_ui_modal_esm._T,{children:[(0,jsx_runtime.jsx)(chakra_ui_modal_esm.fY,{fontSize:"lg",fontWeight:"bold",children:"Watch live-stream"}),(0,jsx_runtime.jsx)(chakra_ui_modal_esm.iP,{children:"Watching the stream while speaking is discouraged. The stream lag can cause a lot of confusion. Please be aware of the expected stream lag and avoid using a second device to watch the stream while you are active in the backstage."}),(0,jsx_runtime.jsxs)(chakra_ui_modal_esm.xo,{children:[(0,jsx_runtime.jsx)(chakra_ui_button_esm.zx,{ref:cancelRef,onClick:function onClick(){return setIsWatchStreamConfirmOpen(!1)},children:"Cancel"}),(0,jsx_runtime.jsx)(chakra_ui_button_esm.zx,{colorScheme:"DestructiveActionButton",onClick:function onClick(){return setWatchStreamForEventId(currentRoomEventId||nextRoomEventId)},ml:3,children:"Watch live-stream"})]})]})})})]}):(0,jsx_runtime.jsx)(chakra_ui_button_esm.zx,{variant:"outline",borderColor:"DestructiveActionButton.600",color:"DestructiveActionButton.600",onClick:function onClick(){return setWatchStreamForEventId(nextRoomEventId)},mt:4,children:"Exit backstage"})}),[currentRoomEventId,isWatchStreamConfirmOpen,nextRoomEventId,selectedEventId,setWatchStreamForEventId]);return(0,react.useMemo)((function(){return showBackstage?(0,jsx_runtime.jsxs)(chakra_ui_layout_esm.xu,{display:showBackstage?"block":"none",py:2,px:4,children:[welcomeInfo,backstages,videoChatForPermissionReset,exitBackstageButton]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}),[videoChatForPermissionReset,backstages,showBackstage,exitBackstageButton,welcomeInfo])}try{Backstages.displayName="Backstages",Backstages.__docgenInfo={description:"",displayName:"Backstages",props:{showBackstage:{defaultValue:null,description:"",name:"showBackstage",required:!0,type:{name:"boolean"}},roomName:{defaultValue:null,description:"",name:"roomName",required:!0,type:{name:"string"}},roomEvents:{defaultValue:null,description:"",name:"roomEvents",required:!0,type:{name:"readonly Room_EventSummaryFragment[]"}},currentRoomEventId:{defaultValue:null,description:"",name:"currentRoomEventId",required:!0,type:{name:"string | null"}},nextRoomEventId:{defaultValue:null,description:"",name:"nextRoomEventId",required:!0,type:{name:"string | null"}},setWatchStreamForEventId:{defaultValue:null,description:"",name:"setWatchStreamForEventId",required:!0,type:{name:"(eventId: string | null) => void"}},onEventSelected:{defaultValue:null,description:"",name:"onEventSelected",required:!0,type:{name:"Dispatch<SetStateAction<string | null>>"}},roomChatId:{defaultValue:null,description:"",name:"roomChatId",required:!0,type:{name:"string | null | undefined"}},selectedEventId:{defaultValue:null,description:"",name:"selectedEventId",required:!0,type:{name:"string | null"}},onLeave:{defaultValue:null,description:"",name:"onLeave",required:!1,type:{name:"(() => void)"}},hlsUri:{defaultValue:null,description:"",name:"hlsUri",required:!0,type:{name:"string | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/aspects/Conference/Attend/Room/Stream/Backstages.tsx#Backstages"]={docgenInfo:Backstages.__docgenInfo,name:"Backstages",path:"src/aspects/Conference/Attend/Room/Stream/Backstages.tsx#Backstages"})}catch(__react_docgen_typescript_loader_error){}}}]);